<el-card class="config-card" header="高级设置">
    <el-form :model="plcConfig" ref="advancedForm" label-width="150px">
        <!-- 通信选项 -->
        <el-row :gutter="24">
            <el-col :span="12">
                <el-form-item label="启用自动重连">
                    <el-switch
                        v-model="plcConfig.enableAutoReconnect"
                        active-text="启用"
                        inactive-text="禁用">
                    </el-switch>
                    <div class="form-help-text">连接断开时自动尝试重连</div>
                </el-form-item>
            </el-col>
            <el-col :span="12">
                <el-form-item label="启用心跳检测">
                    <el-switch
                        v-model="plcConfig.enableHeartbeat"
                        active-text="启用"
                        inactive-text="禁用">
                    </el-switch>
                    <div class="form-help-text">定期发送心跳包检测连接状态</div>
                </el-form-item>
            </el-col>
        </el-row>

        <!-- 数据缓存设置 -->
        <el-divider content-position="left">数据缓存</el-divider>
        <el-row :gutter="24">
            <el-col :span="12">
                <el-form-item label="启用数据缓存">
                    <el-switch
                        v-model="plcConfig.enableDataCache"
                        active-text="启用"
                        inactive-text="禁用">
                    </el-switch>
                </el-form-item>
            </el-col>
            <el-col :span="12">
                <el-form-item label="缓存大小(KB)" v-if="plcConfig.enableDataCache">
                    <el-input-number
                        v-model="plcConfig.cacheSize"
                        :min="64"
                        :max="1024"
                        style="width: 100%">
                    </el-input-number>
                </el-form-item>
            </el-col>
        </el-row>

        <!-- 日志记录设置 -->
        <el-divider content-position="left">日志记录</el-divider>
        <el-row :gutter="24">
            <el-col :span="12">
                <el-form-item label="日志级别">
                    <el-select v-model="plcConfig.logLevel" style="width: 100%">
                        <el-option label="错误" value="Error"></el-option>
                        <el-option label="警告" value="Warning"></el-option>
                        <el-option label="信息" value="Information"></el-option>
                        <el-option label="调试" value="Debug"></el-option>
                    </el-select>
                </el-form-item>
            </el-col>
            <el-col :span="12">
                <el-form-item label="启用通信日志">
                    <el-switch
                        v-model="plcConfig.enableCommLog"
                        active-text="启用"
                        inactive-text="禁用">
                    </el-switch>
                </el-form-item>
            </el-col>
        </el-row>

        <!-- 性能监控 -->
        <el-divider content-position="left">性能监控</el-divider>
        <el-row :gutter="24">
            <el-col :span="12">
                <el-form-item label="启用性能统计">
                    <el-switch
                        v-model="plcConfig.enablePerformanceStats"
                        active-text="启用"
                        inactive-text="禁用">
                    </el-switch>
                </el-form-item>
            </el-col>
            <el-col :span="12">
                <el-form-item label="统计周期(分钟)" v-if="plcConfig.enablePerformanceStats">
                    <el-input-number
                        v-model="plcConfig.statsPeriod"
                        :min="1"
                        :max="60"
                        style="width: 100%">
                    </el-input-number>
                </el-form-item>
            </el-col>
        </el-row>

        <!-- 错误处理 -->
        <el-divider content-position="left">错误处理</el-divider>
        <el-row :gutter="24">
            <el-col :span="12">
                <el-form-item label="错误处理策略">
                    <el-radio-group v-model="plcConfig.errorHandling">
                        <el-radio label="ignore">忽略错误</el-radio>
                        <el-radio label="retry">重试操作</el-radio>
                        <el-radio label="abort">中止连接</el-radio>
                    </el-radio-group>
                </el-form-item>
            </el-col>
            <el-col :span="12">
                <el-form-item label="最大错误次数">
                    <el-input-number
                        v-model="plcConfig.maxErrorCount"
                        :min="1"
                        :max="100"
                        style="width: 100%">
                    </el-input-number>
                </el-form-item>
            </el-col>
        </el-row>

        <!-- 配置导入导出 -->
        <el-divider content-position="left">配置管理</el-divider>
        <el-row>
            <el-col :span="24">
                <el-form-item label="配置文件操作">
                    <el-space>
                        <el-button onclick="exportPLCConfig">
                            <el-icon><Download /></el-icon>导出配置
                        </el-button>
                        <el-upload
                            :show-file-list="false"
                            :before-upload="importPLCConfig"
                            accept=".json">
                            <el-button>
                                <el-icon><Upload /></el-icon>导入配置
                            </el-button>
                        </el-upload>
                        <el-button onclick="resetToDefaults" type="danger">
                            <el-icon><RefreshLeft /></el-icon>恢复默认
                        </el-button>
                    </el-space>
                </el-form-item>
            </el-col>
        </el-row>

        <!-- 配置预览 -->
        <el-divider content-position="left">配置预览</el-divider>
        <el-row>
            <el-col :span="24">
                <el-collapse>
                    <el-collapse-item title="查看当前配置JSON" name="config-preview">
                        <el-input
                            v-model="configPreviewText"
                            type="textarea"
                            :rows="10"
                            readonly
                            style="font-family: monospace;">
                        </el-input>
                    </el-collapse-item>
                </el-collapse>
            </el-col>
        </el-row>
    </el-form>
</el-card>

<style scoped>
.form-help-text {
    font-size: 12px;
    color: #909399;
    margin-top: 4px;
}

.el-divider {
    margin: 20px 0;
}
</style>